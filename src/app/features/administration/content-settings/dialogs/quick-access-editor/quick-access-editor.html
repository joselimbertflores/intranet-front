<form [formGroup]="form" (ngSubmit)="save()">
  <div class="flex items-center justify-end p-2">
    <p-button
      icon="pi pi-plus"
      size="small"
      label="Agregar"
      [outlined]="true"
      (onClick)="addItem()"
    />
  </div>
  <div
    #scrollContainer
    cdkDropList
    (cdkDropListDropped)="drop($event)"
    class="flex flex-col gap-y-3 max-h-[400px] p-2 overflow-y-auto rounded-xl"
    formArrayName="items"
  >
    @for (item of itemsFormArray.controls; track item; let i = $index) {
      <div
        class="group flex flex-col xl:flex-row items-start xl:items-center gap-4 p-4 border border-surface-200 hover:border-primary-400 rounded-xl bg-surface-0 transition-colors shadow-sm"
        [formGroupName]="i"
        cdkDrag
      >
        <div class="flex items-center gap-3 w-full xl:w-auto">
          <div
            cdkDragHandle
            class="cursor-grab active:cursor-grabbing text-surface-400 hover:text-surface-700 p-2"
            pTooltip="Arrastrar para ordenar"
            tooltipPosition="top"
          >
            <i class="pi pi-bars text-xl"></i>
          </div>

          <div
            class="h-12 w-12 shrink-0 flex items-center justify-center rounded-lg border border-surface-200 bg-surface-50 shadow-sm"
          >
            <i
              [class]="item.get('icon')?.value || 'pi pi-question'"
              [style.color]="item.get('color')?.value || 'var(--text-color)'"
              style="font-size: 1.75rem"
            ></i>
          </div>

          <span class="text-sm font-semibold text-surface-500 xl:hidden"
            >Item {{ i + 1 }}</span
          >
        </div>

        <div
          class="grid grid-cols-1 md:grid-cols-12 gap-4 grow w-full items-start"
        >
          <div class="md:col-span-3 flex flex-col gap-1 mt-1">
            <p-floatlabel variant="on">
              <label>Nombre</label>
              <input pInputText class="w-full" formControlName="name" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".name"))) {
              <p-message severity="error" size="small" variant="simple">
                {{
                  formUtils.getErrorMessage(form.get("items." + i + ".name"))
                }}
              </p-message>
            }
          </div>

          <div class="md:col-span-4 flex flex-col gap-1 mt-1">
            <p-floatlabel variant="on">
              <label>URL</label>
              <input pInputText class="w-full" formControlName="url" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".url"))) {
              <p-message severity="error" size="small" variant="simple">
                {{ formUtils.getErrorMessage(form.get("items." + i + ".url")) }}
              </p-message>
            }
          </div>

          <div class="md:col-span-3 flex flex-col gap-1 mt-1">
            <p-floatlabel variant="on">
              <label>Código Ícono</label>
              <input pInputText class="w-full" formControlName="icon" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".icon"))) {
              <p-message severity="error" size="small" variant="simple">
                {{
                  formUtils.getErrorMessage(form.get("items." + i + ".icon"))
                }}
              </p-message>
            }
          </div>

          <div class="md:col-span-2 flex items-center h-12 gap-3 pl-2">
            <p-colorpicker
              formControlName="color"
              [format]="'hex'"
              appendTo="body"
            />
            <span class="text-sm font-medium text-surface-600">Color</span>
          </div>
        </div>

        <div
          class="flex items-center justify-end w-full xl:w-auto mt-2 xl:mt-0"
        >
          <p-button
            [text]="true"
            severity="danger"
            [rounded]="true"
            icon="pi pi-trash"
            (onClick)="removeItem(i)"
            pTooltip="Eliminar acceso"
            tooltipPosition="left"
          />
        </div>
      </div>
    } @empty {
      <div class="flex flex-col items-center justify-center p-4">
        <span class="font-medium">No hay accesos rápidos agregados.</span>
        <span class="text-sm">Haz clic en "Agregar" para comenzar.</span>
      </div>
    }
  </div>
  <div class="p-dialog-footer">
    <p-button
      type="button"
      label="Cancelar"
      severity="secondary"
      (onClick)="close()"
    />
    <p-button type="submit" label="Guardar" />
  </div>
</form>
