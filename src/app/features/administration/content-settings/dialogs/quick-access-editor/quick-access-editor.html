<form [formGroup]="form" (ngSubmit)="save()">
  <div class="flex items-center justify-end p-2">
    <p-button
      icon="pi pi-plus"
      size="small"
      label="Agregar"
      (onClick)="addItem()"
    />
  </div>
  <div
    #scrollContainer
    cdkDropList
    (cdkDropListDropped)="drop($event)"
    class="flex flex-col gap-y-4 max-h-[400px] p-4 overflow-y-auto border border-surface-300 rounded-xl"
    formArrayName="items"
  >
    @for (item of itemsFormArray.controls; track item; let i = $index) {
      <div
        class="flex flex-col gap-4 border rounded-xl p-4 border-surface-300"
        [formGroupName]="i"
        cdkDrag
      >
        <div class="flex items-center justify-between gap-2">
          <div class="flex items-center gap-3">
            <p-button
              cdkDragHandle
              icon="pi pi-bars"
              size="small"
              [text]="true"
            />
            <span
              class="h-12 w-12 flex items-center justify-center bg-surface-200 rounded-xl"
            >
              <i [class]="item.get('icon')?.value" style="font-size: 2rem"></i>
            </span>
            <span class="text-sm font-medium"> Item {{ i + 1 }} </span>
          </div>

          <p-button
            [text]="true"
            severity="danger"
            icon="pi pi-trash"
            size="small"
            (onClick)="removeItem(i)"
          />
        </div>
        <div class="grid grid-cols-1 gap-3 md:grid-cols-3">
          <div class="flex flex-col gap-1">
            <p-floatlabel variant="on">
              <label>Nombre</label>
              <input pInputText class="w-full" formControlName="name" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".name"))) {
              <p-message severity="error" size="small" variant="simple">
                {{
                  formUtils.getErrorMessage(form.get("items." + i + ".name"))
                }}
              </p-message>
            }
          </div>
          <div class="flex flex-col gap-1">
            <p-floatlabel variant="on">
              <label>Codigo Icono</label>
              <input pInputText class="w-full" formControlName="icon" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".icon"))) {
              <p-message severity="error" size="small" variant="simple">
                {{
                  formUtils.getErrorMessage(form.get("items." + i + ".icon"))
                }}
              </p-message>
            }
          </div>
          <div class="flex flex-col gap-1">
            <p-floatlabel variant="on">
              <label>URL</label>
              <input pInputText class="w-full" formControlName="url" />
            </p-floatlabel>
            @if (formUtils.isInvalid(form.get("items." + i + ".url"))) {
              <p-message severity="error" size="small" variant="simple">
                {{ formUtils.getErrorMessage(form.get("items." + i + ".url")) }}
              </p-message>
            }
          </div>
        </div>
      </div>
    } @empty {
      <div class="font-medium">Sin elementos agregados.</div>
    }
  </div>

  <div class="p-dialog-footer">
    <p-button
      type="button"
      label="Cancelar"
      severity="secondary"
      (onClick)="close()"
    />
    <p-button type="submit" label="Guardar" />
  </div>
</form>
