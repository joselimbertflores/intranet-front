<form [formGroup]="form" (ngSubmit)="save()">
  <div class="space-y-2">
    <div class="rounded-2xl border border-surface-200 p-4">
      <h3 class="leading-6 font-medium text-surface-900 mb-4">
        Clasificación del documento
      </h3>
      <div class="flow-root">
        <dl class="-my-3 divide-y divide-surface-200 text-sm">
          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Sección:</dt>

            <dd class="text-gray-700 sm:col-span-2">
              {{ data.section.name }}
            </dd>
          </div>

          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-gray-900">Tipo:</dt>

            <dd class="text-gray-700 sm:col-span-2">
              {{ data.type.name }}
            </dd>
          </div>

          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-gray-900">Subtipo:</dt>

            <dd class="text-gray-700 sm:col-span-2">
              {{ data.subtype?.name || "—" }}
            </dd>
          </div>
        </dl>
      </div>
    </div>
    <div class="rounded-2xl border border-surface-200 p-4">
      <h3 class="leading-6 font-medium text-surface-900 mb-4">
        Información del documento
      </h3>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="sm:col-span-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="docName"
              formControlName="displayName"
              class="w-full"
            />
            <label for="docName">Nombre del documento</label>
          </p-floatlabel>
        </div>

        <p-floatlabel variant="on">
          <p-datepicker
            inputId="yearInput"
            view="year"
            dateFormat="yy"
            showIcon
            iconDisplay="input"
            appendTo="body"
            [readonlyInput]="true"
            [fluid]="true"
            [minDate]="minDateValue"
            [maxDate]="maxDateValue"
            formControlName="date"
          />
          <label for="yearInput">Gestión</label>
        </p-floatlabel>
        <p-select
          [options]="fileStatusOptions"
          formControlName="status"
          optionLabel="name"
          optionValue="value"
          placeholder="Estado"
          class="w-full"
        />
      </div>
    </div>

    <div class="rounded-2xl border border-surface-200 p-4">
      <h3 class="leading-6 font-medium text-surface-900 mb-4">Archivo</h3>

      <div class="flow-root">
        <dl class="-my-3 divide-y divide-surface-200 text-sm">
          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Nombre original:</dt>

            <dd class="text-surface-700 sm:col-span-2">
              <div class="flex items-center gap-x-2">
                <file-icon [fileName]="data.file.originalName" />
                <span>{{ data.file.originalName }}</span>
              </div>
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Descargas:</dt>

            <dd class="text-surface-700 sm:col-span-2">
              <!-- {{ data.downloadCount }} -->
            </dd>
          </div>

          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Tamaño:</dt>

            <dd class="text-surface-700 sm:col-span-2">
              {{ data.file.sizeBytes| fileSize }}
            </dd>
          </div>

          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Fecha creación:</dt>

            <dd class="text-surface-700 sm:col-span-2">
              {{ data.createdAt | date: "short" }}
            </dd>
          </div>
          <div class="grid grid-cols-1 gap-1 py-1 sm:grid-cols-3 sm:gap-4">
            <dt class="font-medium text-surface-900">Fecha edición:</dt>

            <dd class="text-surface-700 sm:col-span-2">
              {{ data.updatedAt | date: "short" }}
            </dd>
          </div>
        </dl>
      </div>

      <div class="mt-6 space-y-3">
        <div class="flex items-center gap-2">
          <p-checkbox
            [(ngModel)]="replaceFile"
            binary="true"
            [ngModelOptions]="{ standalone: true }"
            (onChange)="onReplaceChange($event.checked)"
          ></p-checkbox>
          <label class="text-sm text-surface-600"> Reemplazar archivo </label>
        </div>

        @if (replaceFile()) {
          <p-fileUpload
            mode="basic"
            class="w-full"
            [customUpload]="true"
            [auto]="false"
            [maxFileSize]="maxFileSizeBytes"
            [accept]="acceptAttribute"
            chooseLabel="Seleccionar"
            (onSelect)="onSelectFile($event)"
            invalidFileSizeMessageSummary="Tamaño máximo"
            [invalidFileSizeMessageDetail]="maxFileSizeLabel"
            invalidFileTypeMessageSummary="Formatos permitidos:"
            [invalidFileTypeMessageDetail]="allowedExtensionsLabel"
          />
        }
      </div>
    </div>
  </div>

  <div class="p-dialog-footer">
    <p-button label="Cancelar" severity="secondary" (onClick)="close()" />
    <p-button type="submit" label="Guardar" [disabled]="!isFormValid" />
  </div>
</form>
