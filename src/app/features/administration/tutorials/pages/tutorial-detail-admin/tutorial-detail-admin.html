<div class="max-w-4xl mx-auto w-full flex flex-col gap-6 relative">
  <div
    class="sticky top-0 sm:top-2 z-30 flex flex-col sm:flex-row justify-between items-center gap-4 bg-surface-0/80 backdrop-blur-lg p-2 rounded-xl border border-surface-200 shadow-sm transition-all"
  >
    <div class="flex items-center gap-2 w-full sm:w-auto">
      <p-button
        icon="pi pi-arrow-left"
        label="Volver"
        [text]="true"
        size="small"
        (onClick)="goBack()"
      />
    </div>
    <div class="flex items-center gap-2 w-full sm:w-auto">
      <p-button
        icon="pi pi-sort"
        aria-label="sort"
        severity="secondary"
        size="small"
        label="Guardar orden"
        [disabled]="!isReordered()"
        (onClick)="reoderBlocks()"
      />
      <p-button
        icon="pi pi-pencil"
        aria-label="edit"
        [outlined]="true"
        severity="secondary"
        size="small"
        label="Editar"
        (onClick)="openTutorialEditDialog()"
      />

      <p-button
        icon="pi pi-plus"
        aria-label="add"
        [outlined]="true"
        label="Agregar"
        size="small"
        (click)="menuBloques.toggle($event)"
      />
    </div>
  </div>

  <div class="px-2 sm:px-4 pb-4 sm:pb-6">
    <div class="flex flex-wrap items-center gap-3 mb-4">
      @let isPublished = tutorial.value()?.isPublished;
      <p-tag
        [severity]="isPublished ? 'success' : 'warn'"
        [value]="isPublished ? 'Publicado' : 'Borrador'"
      />
      <span
        class="text-xs sm:text-sm font-semibold text-primary-600 tracking-wider"
      >
        {{ tutorial.value()?.category?.name || "Sin categor√≠a" | uppercase }}
      </span>
    </div>

    <h1 class="text-2xl md:text-5xl font-bold text-surface-900 leading-tight">
      {{ tutorial.value()?.title }}
    </h1>

    @if (tutorial.value()?.summary) {
      <p class="text-base sm:text-lg text-surface-600 mt-2 leading-relaxed">
        {{ tutorial.value()?.summary }}
      </p>
    }
    <div
      class="flex flex-wrap items-center gap-4 text-xs sm:text-sm text-surface-400 mt-6 font-medium"
    >
      <span class="flex items-center gap-1">
        Creado: {{ tutorial.value()?.createdAt | date: "short" }}
      </span>
    </div>
  </div>
  <div
    cdkDropList
    (cdkDropListDropped)="onDrop($event)"
    class="flex flex-col gap-4 mt-2"
  >
    @for (block of blocks(); track $index) {
      <tutorial-block-preview
        [data]="block"
        (edit)="openBlockDialog(block.type, block)"
        (remove)="deleteBlock(block.id)"
      />
    } @empty {
      <div class="text-center">
        <h3 class="font-medium text-lg text-surface-800">
          El tutorial no tiene contenido.
        </h3>
      </div>
    }
  </div>
  <div class="mt-6 mb-4 flex justify-center">
    <button pButton [outlined]="true" (click)="menuBloques.toggle($event)">
      <i class="pi pi-plus text-xl"></i>
      <span class="font-medium text-lg">Agregar bloque</span>
    </button>
    <p-tieredmenu
      #menuBloques
      [model]="menuItems"
      [popup]="true"
      appendTo="body"
      styleClass="mt-2 w-56"
    ></p-tieredmenu>
  </div>
  <div #endOfBlocks></div>
</div>
<p-confirmdialog />
