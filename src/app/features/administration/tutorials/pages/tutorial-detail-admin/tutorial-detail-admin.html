<div class="max-w-4xl mx-auto w-full flex flex-col gap-6 relative">
  <div
    class="sticky top-0 sm:top-2 z-30 flex flex-col sm:flex-row justify-between items-center gap-4 bg-surface-0/80 backdrop-blur-lg p-3 sm:p-2 rounded-2xl border border-surface-200 shadow-sm transition-all"
  >
    <div class="flex items-center gap-2 w-full sm:w-auto">
      <p-button
        icon="pi pi-arrow-left"
        label="Volver"
        [text]="true"
        routerLink="/tutorials"
        styleClass="w-full sm:w-auto"
      ></p-button>
    </div>

    <div class="flex gap-2 w-full sm:w-auto">
      <p-button
        label="Ajustes"
        icon="pi pi-cog"
        [outlined]="true"
        severity="secondary"
        class="flex-1 sm:flex-none"
        styleClass="w-full"
      ></p-button>
      <p-button
        label="Vista Previa"
        icon="pi pi-external-link"
        class="flex-1 sm:flex-none"
        styleClass="w-full"
      ></p-button>
    </div>
  </div>

  <div class="px-2 sm:px-4 pb-4 sm:pb-6 border-b border-surface-200">
    <div class="flex flex-wrap items-center gap-3 mb-4">
      <p-tag
        [severity]="tutorial.value()?.isPublished ? 'success' : 'warn'"
        [value]="tutorial.value()?.isPublished ? 'Publicado' : 'Borrador'"
      >
      </p-tag>
      <span
        class="text-xs sm:text-sm font-semibold text-primary-600 uppercase tracking-wider"
      >
        {{ tutorial.value()?.category?.name || "Sin categoría" }}
      </span>
    </div>

    <h1
      class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-surface-900 leading-tight"
    >
      {{ tutorial.value()?.title }}
    </h1>

    <p
      class="text-base sm:text-lg text-surface-600 mt-4 leading-relaxed"
      *ngIf="tutorial.value()?.summary"
    >
      {{ tutorial.value()?.summary }}
    </p>

    <div
      class="flex flex-wrap items-center gap-4 text-xs sm:text-sm text-surface-400 mt-6 font-medium"
    >
      <span class="flex items-center gap-1">
        <i class="pi pi-calendar"></i> Creado:
        {{ tutorial.value()?.createdAt | date: "shortDate" }}
      </span>
      <!-- <span class="flex items-center gap-1">
        <i class="pi pi-clock"></i> Actualizado:
        {{ tutorial.value()?.updatedAt | date: "short" }}
      </span> -->
    </div>
  </div>

  <div
    cdkDropList
    (cdkDropListDropped)="onDrop($event)"
    class="flex flex-col gap-4 mt-2"
  >
    @for (block of blocks(); track $index) {
      <tutorial-block-preview
        [data]="block"
        (edit)="openBlockDialog(block.type, block)"
        (remove)="deleteBlock(block.id)"
      />
    } @empty {
      <div class="flex flex-col items-center py-12 px-4 text-center">
        <h3 class="font-semibold text-lg text-surface-800 m-0 mb-1">
          El tutorial no tiene contenido
        </h3>
        <p class="text-sm text-surface-500 max-w-sm m-0 mb-5">
          Comienza a construir tu tutorial añadiendo bloques de texto, imágenes,
          videos o archivos adjuntos.
        </p>
      </div>
    }
  </div>
  <div class="mt-8 mb-4 flex justify-center">
    <button pButton [outlined]="true" (click)="menuBloques.toggle($event)">
      <i class="pi pi-plus text-xl"></i>
      <span class="font-medium text-lg">Añadir nuevo bloque</span>
    </button>
    <p-tieredmenu
      #menuBloques
      [model]="menuItems"
      [popup]="true"
      appendTo="body"
      styleClass="mt-2 w-56"
    ></p-tieredmenu>
  </div>
  <div #endOfBlocks></div>
</div>
<p-confirmdialog />
