<div class="flex flex-col gap-5 max-w-5xl mx-auto pb-10">
  <header class="flex items-center gap-3">
    <button
      pButton
      pRipple
      icon="pi pi-arrow-left"
      class="p-button-rounded p-button-text p-button-secondary"
      aria-label="Volver"
      (click)="goBack()"
    ></button>
    <h1 class="text-2xl font-semibold text-surface-900 m-0">
      Editor de Tutorial
    </h1>
  </header>

  <section class="flex flex-col gap-5 mb-6 p-4">
    <div class="flex flex-col gap-3">
      <h2
        class="text-xl sm:text-2xl font-semibold text-surface-900 leading-tight wrap-break-word"
      >
        {{ tutorial.value()?.title }}
      </h2>
      <p class="text-surface-600 m-0 leading-relaxed text-sm sm:text-base">
        {{ tutorial.value()?.summary }}
      </p>
    </div>

    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 pt-4 border-t border-surface-300"
    >
      <div
        class="flex flex-wrap items-center gap-3 sm:gap-4 text-xs sm:text-sm text-surface-500 font-medium"
      >
        <div class="flex items-center gap-1.5" title="Fecha de creación">
          <i class="pi pi-calendar"></i>
          <span>{{ tutorial.value()?.createdAt | date: "mediumDate" }}</span>
        </div>

        <div class="flex items-center">
          @if (tutorial.value()?.isPublished) {
            <span
              class="bg-green-100 text-green-700 px-2.5 py-1 rounded-md text-xs font-bold tracking-wide flex items-center gap-1.5"
            >
              <i class="pi pi-check-circle text-[10px]"></i> Publicado
            </span>
          } @else {
            <span
              class="bg-surface-200 text-surface-600 px-2.5 py-1 rounded-md text-xs font-bold tracking-wide flex items-center gap-1.5"
            >
              <i class="pi pi-eye-slash text-[10px]"></i> Borrador
            </span>
          }
        </div>

        @if (tutorial.value()?.category) {
          <div class="flex items-center">
            <span
              class="bg-primary-50 text-primary-700 border border-primary-100 px-2.5 py-1 rounded-md text-xs font-bold uppercase tracking-wide"
            >
              {{ tutorial.value()?.category?.name }}
            </span>
          </div>
        }
      </div>

      <div class="w-full sm:w-auto shrink-0">
        <button
          pButton
          pRipple
          label="Editar información"
          icon="pi pi-pencil"
          class="p-button-outlined p-button-sm w-full sm:w-auto"
        ></button>
      </div>
    </div>
  </section>

  <div
    class="sticky top-2 z-20 bg-surface-0 border border-surface-200 rounded-lg shadow-sm px-4 py-3 flex sm:justify-between items-center"
  >
    <div class="font-semibold text-surface-800 hidden sm:block">
      Contenido del Tutorial
    </div>
    <div class="flex items-center gap-2">
      <p-menu #menu [model]="menuItems" [popup]="true" appendTo="body" />
      <button
        pButton
        label="Añadir"
        icon="pi pi-plus"
        size="small"
        [outlined]="true"
        (click)="menu.toggle($event)"
      ></button>
      <button
        pButton
        size="small"
        label="Guardar orden"
        icon="pi pi-save"
        class="p-button-secondary"
        disabled
      ></button>
    </div>
  </div>
  <section
    cdkDropList
    (cdkDropListDropped)="onDrop($event)"
    class="flex flex-col gap-4 min-h-[100px]"
  >
    @for (block of blocks(); track $index) {
      <tutorial-block-preview
        [data]="block"
        (edit)="openBlockDialog(block.type, block)"
        (delete)="deleteBlock(block.id)"
      />
    } @empty {
      <div class="flex flex-col items-center py-12 px-4 text-center">
        <h3 class="font-semibold text-lg text-surface-800 m-0 mb-1">
          El tutorial no tiene contenido
        </h3>
        <p class="text-sm text-surface-500 max-w-sm m-0 mb-5">
          Comienza a construir tu tutorial añadiendo bloques de texto, imágenes,
          videos o archivos adjuntos.
        </p>
      </div>
    }
  </section>
</div>
<p-confirmdialog />
